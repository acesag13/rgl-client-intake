<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connect Your Accounts â€” Rebel Growth Labs</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --purple:   #8B5CF6;
  --purple-2: #B000E8;
  --gold:     #F5C542;
  --teal:     #06B6D4;
  --coral:    #E74C3C;
  --green:    #2A7A4B;
  --bg:       #000000;
  --navy:     #0F172A;
  --divider:  #1E2D3D;
  --divider-2:#243845;
  --slate:    #64748B;
  --slate-2:  #8A9BAD;
  --white:    #FFFFFF;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family:'DM Sans',sans-serif;
  background:var(--bg);
  color:var(--white);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  overflow-x:hidden;
}

.glow { position:fixed; border-radius:50%; pointer-events:none; z-index:0; filter:blur(80px); }
.glow-1 { top:-200px; right:-200px; width:600px; height:600px; background:rgba(139,92,246,0.12); }
.glow-2 { bottom:-200px; left:-200px; width:500px; height:500px; background:rgba(176,0,232,0.08); }

header {
  position:relative; z-index:10;
  border-bottom:1px solid var(--divider);
  padding:18px 40px;
  display:flex; justify-content:space-between; align-items:center;
  background:rgba(0,0,0,0.9);
  backdrop-filter:blur(20px);
}

.brand { display:flex; align-items:center; gap:12px; }
.brand svg { width:32px; height:32px; }
.brand-name { font-family:'DM Sans',sans-serif; font-weight:700; font-size:12px; letter-spacing:0.12em; text-transform:uppercase; }
.brand-name span { color:var(--purple); }
.secure { font-family:'Plus Jakarta Sans',sans-serif; font-size:11px; color:var(--slate); display:flex; align-items:center; gap:5px; }

main {
  flex:1; position:relative; z-index:1;
  max-width:600px; margin:0 auto; width:100%;
  padding:72px 40px 80px;
  display:flex; flex-direction:column; align-items:center;
  text-align:center;
}

.eyebrow {
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3);
  padding:6px 16px; border-radius:100px;
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:11px; font-weight:600; color:var(--purple);
  letter-spacing:0.1em; text-transform:uppercase;
  margin-bottom:28px;
}

.pulse { width:6px; height:6px; border-radius:50%; background:var(--purple); animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:0.3} 50%{opacity:1} }

h1 {
  font-family:'DM Serif Display',serif;
  font-size:clamp(32px,5vw,50px); font-weight:400;
  line-height:1.08; margin-bottom:18px;
}
h1 em { font-style:normal; color:var(--purple); }

.sub {
  font-size:15px; color:rgba(255,255,255,0.5);
  line-height:1.7; font-weight:300;
  max-width:460px; margin:0 auto 48px;
}

/* Progress steps */
.steps {
  display:flex; align-items:center; gap:0;
  margin-bottom:48px; width:100%; max-width:380px;
}

.step-item {
  flex:1; display:flex; flex-direction:column;
  align-items:center; gap:8px; position:relative;
}

.step-item:not(:last-child)::after {
  content:''; position:absolute;
  top:15px; left:calc(50% + 18px);
  width:calc(100% - 36px); height:1px;
  background:var(--divider-2);
}

.step-item.done:not(:last-child)::after { background:var(--purple); }

.step-node {
  width:30px; height:30px; border-radius:50%;
  border:1px solid var(--divider-2);
  display:flex; align-items:center; justify-content:center;
  font-size:13px; background:var(--bg);
  transition:all 0.3s; z-index:1;
}

.step-item.active .step-node { border-color:var(--purple); background:rgba(139,92,246,0.15); box-shadow:0 0 14px rgba(139,92,246,0.3); }
.step-item.done .step-node { border-color:var(--purple); background:var(--purple); }

.step-lbl {
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:10px; font-weight:600; color:var(--slate);
  letter-spacing:0.04em;
}
.step-item.active .step-lbl { color:var(--purple); }
.step-item.done .step-lbl { color:rgba(139,92,246,0.6); }

/* Connect cards */
.connect-cards { width:100%; display:flex; flex-direction:column; gap:12px; margin-bottom:32px; }

.connect-card {
  border:1px solid var(--divider-2);
  border-radius:3px; padding:24px;
  display:flex; align-items:center; gap:20px;
  text-align:left; background:rgba(255,255,255,0.02);
  transition:border-color 0.2s;
  position:relative; overflow:hidden;
}

.connect-card.connected { border-color:rgba(42,122,75,0.4); background:rgba(42,122,75,0.04); }
.connect-card.pending { border-color:var(--divider-2); }

.card-icon {
  width:52px; height:52px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
}

.card-icon.square { background:#FFFFFF; border:1px solid rgba(255,255,255,0.1); padding:10px; }
.card-icon.meta   { background:#1877F2; border:1px solid rgba(24,119,242,0.3); padding:10px; }
.card-icon svg    { width:100%; height:100%; display:block; }

.card-body { flex:1; }

.card-title {
  font-family:'DM Sans',sans-serif; font-weight:700;
  font-size:16px; color:var(--white); margin-bottom:4px;
}

.card-desc { font-size:12.5px; color:var(--slate); line-height:1.5; }

.card-status {
  display:flex; align-items:center; gap:6px;
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:11px; font-weight:600;
  margin-top:8px;
}

.card-status.waiting { color:var(--slate); }
.card-status.done-status { color:#7DD4A8; }

.status-dot { width:6px; height:6px; border-radius:50%; background:currentColor; }

.connect-btn {
  flex-shrink:0;
  padding:11px 20px;
  border-radius:3px; border:none;
  font-family:'DM Sans',sans-serif; font-weight:700;
  font-size:13px; cursor:pointer;
  transition:opacity 0.2s, transform 0.1s;
  white-space:nowrap;
  text-decoration:none;
  display:inline-flex; align-items:center; gap:6px;
}

.connect-btn:active { transform:scale(0.98); }

.connect-btn.sq-btn {
  background:linear-gradient(135deg,var(--purple),var(--purple-2));
  color:var(--white);
}

.connect-btn.meta-btn {
  background:#1877F2; color:var(--white);
}

.connect-btn.connected-btn {
  background:rgba(42,122,75,0.15);
  border:1px solid rgba(42,122,75,0.35);
  color:#7DD4A8; cursor:default;
}

.connect-btn:hover:not(.connected-btn) { opacity:0.88; }

/* Info note */
.info-note {
  display:flex; align-items:flex-start; gap:10px;
  background:rgba(245,197,66,0.05); border:1px solid rgba(245,197,66,0.15);
  border-radius:3px; padding:14px 16px;
  text-align:left; width:100%;
}

.info-note p { font-size:12.5px; color:rgba(245,197,66,0.8); line-height:1.55; }
.info-note p strong { color:var(--gold); font-weight:600; }

footer {
  border-top:1px solid var(--divider); padding:22px 40px;
  display:flex; justify-content:space-between; align-items:center;
  flex-wrap:wrap; gap:8px; position:relative; z-index:1;
}
footer span { font-family:'Plus Jakarta Sans',sans-serif; font-size:11px; color:var(--slate); }
footer a { color:var(--purple); text-decoration:none; }

@media(max-width:600px){
  header { padding:14px 20px; }
  main { padding:48px 20px 64px; }
  footer { padding:18px 20px; flex-direction:column; gap:4px; text-align:center; }
  .connect-card { flex-wrap:wrap; }
  .connect-btn { width:100%; justify-content:center; }
}
</style>
</head>
<body>

<div class="glow glow-1"></div>
<div class="glow glow-2"></div>

<header>
  <div class="brand">
    <svg viewBox="0 0 32 32" fill="none">
      <ellipse cx="16" cy="16" rx="13" ry="6" stroke="#8B5CF6" stroke-width="1.5"/>
      <ellipse cx="16" cy="16" rx="13" ry="6" stroke="#8B5CF6" stroke-width="1.5" transform="rotate(60 16 16)"/>
      <ellipse cx="16" cy="16" rx="13" ry="6" stroke="#8B5CF6" stroke-width="1.5" transform="rotate(120 16 16)"/>
      <circle cx="16" cy="16" r="2.5" fill="#8B5CF6"/>
    </svg>
    <div class="brand-name">REBEL GROWTH <span>LABS</span></div>
  </div>
  <div class="secure">ðŸ”’ Secure OAuth 2.0</div>
</header>

<main>
  <div class="eyebrow"><span class="pulse"></span> Body Shop Wellness Â· Integration Setup</div>
  <h1>Connect Your <em>Accounts</em></h1>
  <p class="sub">Two clicks. No copying credentials. You'll be redirected to Square and Facebook to approve access â€” that's it. Rebel Growth Labs handles everything after that.</p>

  <div class="steps">
    <div class="step-item active" id="si-square">
      <div class="step-node">
        <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><rect x="2" y="2" width="20" height="20" rx="4" ry="4" fill="none" stroke="currentColor" stroke-width="2"/><rect x="8" y="8" width="8" height="8" rx="1" ry="1"/></svg>
      </div>
      <div class="step-lbl">Square</div>
    </div>
    <div class="step-item" id="si-meta">
      <div class="step-node">
        <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
      </div>
      <div class="step-lbl">Facebook</div>
    </div>
    <div class="step-item" id="si-done">
      <div class="step-node">âœ“</div>
      <div class="step-lbl">Done</div>
    </div>
  </div>

  <div class="connect-cards">

    <!-- Square -->
    <div class="connect-card" id="card-square">
      <div class="card-icon square">
        <!-- Square logo -->
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="1" y="1" width="22" height="22" rx="4" fill="#3E4348"/>
          <rect x="1" y="1" width="22" height="22" rx="4" stroke="#3E4348" stroke-width="0"/>
          <rect x="6" y="6" width="12" height="12" rx="2" fill="white"/>
          <rect x="9.5" y="9.5" width="5" height="5" rx="0.8" fill="#3E4348"/>
        </svg>
      </div>
      <div class="card-body">
        <div class="card-title">Square</div>
        <div class="card-desc">Grants read access to your customers, transactions, orders, invoices, and catalog. Used to pull purchase history and match it to your leads.</div>
        <div class="card-status waiting" id="sq-status">
          <span class="status-dot"></span> Waiting for authorization
        </div>
      </div>
      <a class="connect-btn sq-btn" id="sq-btn" href="#" onclick="connectSquare(event)">Connect Square â†’</a>
    </div>

    <!-- Meta -->
    <div class="connect-card" id="card-meta">
      <div class="card-icon meta">
        <!-- Facebook logo -->
        <svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
      </div>
      <div class="card-body">
        <div class="card-title">Facebook / Meta</div>
        <div class="card-desc">Grants access to your ad account and pixel so we can send offline purchase events back to Meta and close the attribution loop.</div>
        <div class="card-status waiting" id="meta-status">
          <span class="status-dot"></span> Waiting for authorization
        </div>
      </div>
      <a class="connect-btn meta-btn" id="meta-btn" href="#" onclick="connectMeta(event)">Connect Facebook â†’</a>
    </div>

  </div>

  <div class="info-note">
    <span>ðŸ’¡</span>
    <p><strong>What you're authorizing:</strong> Read-only access to purchase and customer data in Square, and the ability to send offline conversion events to your Meta Pixel. We cannot process payments, post ads, or modify any account settings.</p>
  </div>

</main>

<footer>
  <span>Â© 2026 <a href="https://rebelgrowthlabs.com">Rebel Growth Labs</a> Â· All rights reserved.</span>
  <span>Flat Businesses Guess. 3D Businesses Grow.</span>
</footer>

<script>
  const SQUARE_APP_ID = 'sq0idp-qg7_Kki_Ae_1sEzsOdI34g';
  const META_APP_ID   = '1414685950290334';
  const BASE_URL      = 'https://rgl-client-intake-iyn1.vercel.app';

  // Square: space-separated scopes (correct per Square OAuth docs)
  const SQUARE_SCOPES = [
    'CUSTOMERS_READ',
    'PAYMENTS_READ',
    'ORDERS_READ',
    'MERCHANT_PROFILE_READ',
    'INVOICES_READ',
    'SUBSCRIPTIONS_READ',
    'CATALOG_READ'
  ].join(' ');

  // Meta: comma-separated, includes pages_read_engagement for pixel access
  const META_SCOPES = 'ads_read,ads_management,business_management,pages_read_engagement';

  function generateState(prefix) {
    const state = prefix + '_' + Math.random().toString(36).substring(2, 15);
    // localStorage persists across OAuth redirects; sessionStorage does not
    localStorage.setItem('oauth_state', state);
    return state;
  }

  function connectSquare(e) {
    e.preventDefault();
    const state = generateState('square');
    const url = `https://connect.squareup.com/oauth2/authorize`
      + `?client_id=${SQUARE_APP_ID}`
      + `&scope=${encodeURIComponent(SQUARE_SCOPES)}`
      + `&session=false`
      + `&state=${state}`
      + `&redirect_uri=${encodeURIComponent(BASE_URL + '/callback')}`;
    window.location.href = url;
  }

  function connectMeta(e) {
    e.preventDefault();
    const state = generateState('meta');
    const url = `https://www.facebook.com/v19.0/dialog/oauth`
      + `?client_id=${META_APP_ID}`
      + `&redirect_uri=${encodeURIComponent(BASE_URL + '/callback')}`
      + `&scope=${META_SCOPES}`
      + `&state=${state}`
      + `&response_type=code`;
    window.location.href = url;
  }

  function applyConnectedState() {
    const sqDone   = localStorage.getItem('square_connected');
    const metaDone = localStorage.getItem('meta_connected');

    if (sqDone) {
      document.getElementById('card-square').classList.add('connected');
      document.getElementById('sq-status').className = 'card-status done-status';
      document.getElementById('sq-status').innerHTML = '<span class="status-dot"></span> Connected âœ“';
      document.getElementById('sq-btn').className = 'connect-btn connected-btn';
      document.getElementById('sq-btn').textContent = 'âœ“ Connected';
      document.getElementById('si-square').classList.add('done');
      document.getElementById('si-meta').classList.add('active');
    }

    if (metaDone) {
      document.getElementById('card-meta').classList.add('connected');
      document.getElementById('meta-status').className = 'card-status done-status';
      document.getElementById('meta-status').innerHTML = '<span class="status-dot"></span> Connected âœ“';
      document.getElementById('meta-btn').className = 'connect-btn connected-btn';
      document.getElementById('meta-btn').textContent = 'âœ“ Connected';
      document.getElementById('si-meta').classList.add('done');
      document.getElementById('si-done').classList.add('active');
    }

    if (sqDone && metaDone) {
      window.location.href = '/success';
    }
  }

  window.addEventListener('DOMContentLoaded', applyConnectedState);
</script>
</body>
</html>
